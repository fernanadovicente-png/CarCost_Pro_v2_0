<!doctype html>
<html lang="pt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>CarCost Pro</title>
  <meta name="theme-color" content="#0b3d2e"/>
  <link rel="manifest" href="manifest.json"/>
  <link rel="icon" href="assets/icon-192.png" sizes="192x192"/>
  <link rel="stylesheet" href="css/style.css"/>
</head>
<body>
<div class="container">
<header class="header">
  <div class="logo"><img src="assets/logo.svg" alt="CarCost Pro" height="48"/></div>
  <div style="display:flex;gap:8px">
    <button id="installBtn" class="btn" style="display:none" data-i18n="install">Instalar</button>
    <button id="resetBtn" class="btn" data-i18n="reset">Reiniciar</button>
  </div>
</header>

<nav class="tabs">
  <button class="tab active" data-tab="dashboard">📊 <span data-i18n="dashboard">Dashboard</span></button>
  <button class="tab" data-tab="daily">🧾 <span data-i18n="daily">Dia-a-Dia</span></button>
  <button class="tab" data-tab="fuels">⛽ <span data-i18n="fuels">Abastecimentos</span></button>
  <button class="tab" data-tab="fixos">💶 <span data-i18n="fixos">Fixos</span></button>
  <button class="tab" data-tab="config">⚙️ <span data-i18n="config">Config</span></button>
</nav>

<section data-tab="dashboard">
  <div class="row">
    <div class="card kpi"><div class="label" data-i18n="kpi_monthly">Total Mensal</div><div id="kpiMensal" class="value">—</div></div>
    <div class="card kpi"><div class="label" data-i18n="kpi_yearly">Total Anual</div><div id="kpiAnual" class="value">—</div></div>
    <div class="card kpi"><div class="label" data-i18n="kpi_cost_km">Custo real / km</div><div id="kpiCustoKm" class="value">—</div></div>
    <div class="card kpi"><div class="label" data-i18n="fuel_cost_km_last">Custo real/km (último abastecimento)</div><div id="kpiFuelLast" class="value">—</div></div>
  </div>
  <div class="row-2" style="margin-top:12px">
    <div class="card">
      <div class="label" data-i18n="period">Período</div>
      <div style="display:flex;gap:8px;margin:8px 0">
        <label><input type="radio" name="period" value="week"> <span data-i18n="week">Semana</span></label>
        <label><input type="radio" name="period" value="month" checked> <span data-i18n="month">Mês</span></label>
        <label><input type="radio" name="period" value="year"> <span data-i18n="year">Ano</span></label>
      </div>
      <canvas id="pieCanvas" width="420" height="260"></canvas>
    </div>
    <div class="card">
      <div class="label">Resumo</div>
      <ul id="resumoLista" style="list-style:none;padding-left:0"></ul>
      <div class="small" style="margin-top:8px" data-i18n="download_hint">Instala para usar offline.</div>
    </div>
  </div>
</section>

<section data-tab="daily" style="display:none">
  <div class="card">
    <h3 class="value" style="font-size:20px">Dia-a-Dia</h3>
    <div class="row-3" style="margin-top:10px">
      <div><div class="label" data-i18n="date">Data</div><input id="dDate" class="input" type="date"/></div>
      <div><div class="label" data-i18n="daily_tolls">Portagens</div><input id="dTolls" class="input" type="number" step="0.01" placeholder="0"/></div>
      <div><div class="label" data-i18n="daily_parking">Parques</div><input id="dParking" class="input" type="number" step="0.01" placeholder="0"/></div>
      <div><div class="label" data-i18n="daily_other">Outros</div><input id="dOther" class="input" type="number" step="0.01" placeholder="0"/></div>
      <div style="grid-column:1/-1"><div class="label" data-i18n="notes">Notas</div><textarea id="dNotes" class="input" rows="2" placeholder="..."></textarea></div>
    </div>
    <div style="margin-top:10px"><button id="addDaily" class="btn primary" data-i18n="add">Adicionar</button></div>
  </div>
  <div id="dailyList" style="margin-top:12px"></div>
</section>

<section data-tab="fuels" style="display:none">
  <div class="card">
    <h3 class="value" style="font-size:20px">Abastecimentos</h3>
    <div class="row-3" style="margin-top:10px">
      <div><div class="label" data-i18n="date">Data</div><input id="fDate" class="input" type="date"/></div>
      <div><div class="label" data-i18n="odo">Odómetro (km)</div><input id="fOdo" class="input" type="number" step="1" placeholder="52340"/></div>
      <div><div class="label" data-i18n="fuel_amount">€ abastecido</div><input id="fAmount" class="input" type="number" step="0.01" placeholder="60"/></div>
      <div><div class="label" data-i18n="liters">Litros (opcional)</div><input id="fLiters" class="input" type="number" step="0.01" placeholder="32"/></div>
      <div><div class="label" data-i18n="extras">Extras</div><input id="fExtras" class="input" type="number" step="0.01" placeholder="4.5"/></div>
      <div style="grid-column:1/-1"><div class="label" data-i18n="notes">Notas</div><textarea id="fNotes" class="input" rows="2" placeholder="..."></textarea></div>
    </div>
    <div style="margin-top:10px"><button id="addFuel" class="btn primary" data-i18n="add">Adicionar</button></div>
  </div>
  <div class="card" style="margin-top:12px">
    <div class="label" data-i18n="km_period">Km do período (manual, opcional)</div>
    <div style="display:flex;gap:8px;margin-top:6px">
      <input id="kmWeek" class="input" type="number" step="1" placeholder="semana" oninput="state.kmManual.week=this.value; localStorage.setItem(SKEY, JSON.stringify(state));"/>
      <input id="kmMonth" class="input" type="number" step="1" placeholder="mês" oninput="state.kmManual.month=this.value; localStorage.setItem(SKEY, JSON.stringify(state));"/>
      <input id="kmYear" class="input" type="number" step="1" placeholder="ano" oninput="state.kmManual.year=this.value; localStorage.setItem(SKEY, JSON.stringify(state));"/>
    </div>
  </div>
  <div id="fuelList" style="margin-top:12px"></div>
</section>

<section data-tab="fixos" style="display:none">
  <div class="card">
    <h3 class="value" style="font-size:20px">Fixos</h3>
    <div class="row-3" style="margin-top:10px">
      <div><div class="label">Seguro (anual)</div><input id="fxSeguro" class="input" type="number" step="0.01"/></div>
      <div><div class="label">IUC (anual)</div><input id="fxIuc" class="input" type="number" step="0.01"/></div>
      <div><div class="label">Leasing (mensal)</div><input id="fxLeasing" class="input" type="number" step="0.01"/></div>
      <div><div class="label">Parque (mensal)</div><input id="fxParque" class="input" type="number" step="0.01"/></div>
      <div><div class="label">Inspeção/Lav.</div><input id="fxInspec" class="input" type="number" step="0.01"/></div>
      <div><div class="label">Outros</div><input id="fxOutros" class="input" type="number" step="0.01"/></div>
    </div>
    <div style="margin-top:10px"><button id="saveFixos" class="btn primary">Guardar</button></div>
  </div>
</section>

<section data-tab="config" style="display:none">
  <div class="card">
    <h3 class="value" style="font-size:20px" data-i18n="config">Config</h3>
    <div class="row-3" style="margin-top:10px">
      <div><div class="label" data-i18n="currency">Moeda</div><select id="cfgMoeda" class="input"><option value="EUR">EUR</option><option value="CHF">CHF</option><option value="USD">USD</option><option value="BRL">BRL</option></select></div>
      <div><div class="label" data-i18n="theme">Tema</div><select id="cfgTema" class="input"><option value="dark" data-i18n="dark">Escuro</option><option value="light" data-i18n="light">Claro</option></select></div>
      <div><div class="label" data-i18n="language">Idioma</div><select id="cfgLang" class="input"><option value="pt">🇵🇹 PT</option><option value="en">🇬🇧 EN</option><option value="fr">🇫🇷 FR</option><option value="es">🇪🇸 ES</option></select></div>
    </div>
    <div style="margin-top:10px"><button id="saveCfg" class="btn primary">Guardar</button></div>
  </div>
</section>
</div>

<script src="js/i18n.js"></script>
<script src="js/charts.js"></script>
<script src="js/app.js"></script>

<script>
let deferredPrompt=null;
window.addEventListener('beforeinstallprompt',(e)=>{e.preventDefault();deferredPrompt=e;const btn=document.getElementById('installBtn');btn.style.display='inline-block';btn.onclick=async()=>{btn.disabled=true;try{await deferredPrompt.prompt();await deferredPrompt.userChoice;}catch(_){}btn.style.display='none';};});
if('serviceWorker' in navigator){navigator.serviceWorker.register('./service-worker.js');}
</script>
</body>
</html>